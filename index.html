<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫</title>
<style>
body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f7fb; color: #333; }
header { background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 1rem; text-align: center; color: white; font-size: 1.5rem; font-weight: bold; position: relative; }
.edit-btn { position: absolute; right: 10px; top: 10px; background: black; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 20px; cursor: pointer; }
.days { display: flex; overflow-x: auto; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.day { min-width: 120px; padding: 0.7rem; text-align: center; font-weight: 600; border-bottom: 3px solid transparent; cursor: pointer; }
.day.active { border-bottom: 3px solid #4facfe; color: #4facfe; }
.schedule { padding: 1rem; }
.lesson { background: white; margin-bottom: 0.7rem; padding: 0.9rem; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
.lesson h4 { margin: 0 0 0.3rem 0; font-size: 1rem; }
.lesson small { color: #666; }
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; }
.modal-content { background: white; padding: 1rem; border-radius: 16px; width: 90%; max-height: 80%; overflow-y: auto; }
input, textarea { width: 100%; padding: 0.5rem; margin: 0.5rem 0; border: 1px solid #ccc; border-radius: 8px; }
.close-btn { background: #f44336; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; float: right; }
button.save-btn { background: #4facfe; border: none; padding: 0.7rem 1.2rem; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; margin-top: 0.5rem; }
</style>
</head>
<body>
<header>
üìò –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫
<button class="edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–∞—à–∫—É" onclick="promptPassword()">üñâ</button>
</header>

<div class="days" id="days"></div>
<div class="schedule" id="schedule"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    <h3 id="modalTitle"></h3>
    <textarea id="homework" placeholder="–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ"></textarea>
    <button class="save-btn" onclick="saveLesson()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
const GITHUB_TOKEN = "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";
const REPO = "Romalakino/school-diary";
const FILE_PATH = "dz.json";
const PASSWORD = "12345";

const daysOfWeek = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞"];
let scheduleData = {};
let currentDay = daysOfWeek[0];
let currentLessonIndex = null;
let canEdit = false;

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
async function loadData() {
  const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/${FILE_PATH}`);
  scheduleData = await res.json();
  renderDays();
  renderSchedule();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
function renderDays() {
  const container = document.getElementById("days");
  container.innerHTML = "";
  daysOfWeek.forEach(day => {
    const div = document.createElement("div");
    div.className = "day" + (day===currentDay?" active":"");
    div.textContent = day;
    div.onclick = () => { currentDay = day; renderDays(); renderSchedule(); };
    container.appendChild(div);
  });
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É—Ä–æ–∫–æ–≤
function renderSchedule() {
  const container = document.getElementById("schedule");
  container.innerHTML = "";
  scheduleData[currentDay].forEach((lesson,i)=>{
    const div = document.createElement("div");
    div.className = "lesson";
    div.innerHTML = `<h4>${i+1}. ${lesson.name}</h4><small>${lesson.homework || "–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ"}</small>`;
    if(canEdit) div.onclick = ()=>openModal(i);
    container.appendChild(div);
  });
}

// –ö–Ω–æ–ø–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à -> –≤–≤–æ–¥ –ø–∞—Ä–æ–ª—è
function promptPassword() {
  const pwd = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:");
  if(pwd === PASSWORD) { canEdit = true; alert("‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!"); renderSchedule(); }
  else alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function openModal(index){
  currentLessonIndex = index;
  const lesson = scheduleData[currentDay][index];
  document.getElementById("modalTitle").textContent = lesson.name;
  document.getElementById("homework").value = lesson.homework || "";
  document.getElementById("modal").style.display = "flex";
}

function closeModal(){ document.getElementById("modal").style.display = "none"; }

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–∫–∏ –Ω–∞ GitHub
async function saveLesson(){
  const lesson = scheduleData[currentDay][currentLessonIndex];
  lesson.homework = document.getElementById("homework").value;

  const url = `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`;
  const r = await fetch(url, { headers: { Authorization: `token ${GITHUB_TOKEN}` } });
  const sha = (await r.json()).sha;
  const content = btoa(unescape(encodeURIComponent(JSON.stringify(scheduleData,null,2))));
  
  const res = await fetch(url, {
    method: "PUT",
    headers: { Authorization: `token ${GITHUB_TOKEN}` },
    body: JSON.stringify({ message: `${currentDay} homework update`, content, sha })
  });
  
  if(res.ok){ alert("‚úÖ –î–æ–º–∞—à–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!"); closeModal(); renderSchedule(); }
  else alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");
}

loadData();
</script>
</body>
</html>
