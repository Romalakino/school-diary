<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫</title>
  <style>
    /* === –¢–≤–æ–π CSS –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π === */
    body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f7fb; color: #333; }
    header { background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 1rem; text-align: center; color: white; font-size: 1.5rem; font-weight: bold; }
    .days { display: flex; overflow-x: auto; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .day { min-width: 120px; padding: 0.7rem; text-align: center; font-weight: 600; border-bottom: 3px solid transparent; cursor: pointer; }
    .day.active { border-bottom: 3px solid #4facfe; color: #4facfe; }
    .schedule { padding: 1rem; }
    .lesson { background: white; margin-bottom: 0.7rem; padding: 0.9rem; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
    .lesson h4 { margin: 0 0 0.3rem 0; font-size: 1rem; }
    .lesson small { color: #666; }
    .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 0.7rem 0; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); }
    .bottom-bar button { background: #4facfe; border: none; padding: 0.7rem 1.2rem; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; }
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 1rem; border-radius: 16px; width: 90%; max-height: 80%; overflow-y: auto; }
    .modal-content h3 { margin-top: 0; }
    .readonly { width: 100%; padding: 0.5rem; margin: 0.5rem 0; border-radius: 8px; background:#f4f4f4; border:1px solid #e0e0e0; }
    .close-btn { background: #f44336; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; float: right; }
  </style>
</head>
<body>
  <header>üìò –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫</header>
  <div class="days" id="days"></div>
  <div class="schedule" id="schedule"></div>

  <div class="bottom-bar">
    <button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      <h3 id="modalTitle"></h3>
      <div id="homeworkText" class="readonly"></div>
      <div id="deadlineText" class="readonly"></div>
      <div id="gradeText" class="readonly"></div>
    </div>
  </div>

  <script>
    const RAW_URL = "https://raw.githubusercontent.com/Romalakino/school-diary/main/dz.json";
    let scheduleData = {};
    let daysOfWeek = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞"];
    let currentDay = daysOfWeek[0];

    async function loadSchedule(){
      try{
        const res = await fetch(RAW_URL + "?nocache=" + Date.now());
        if(!res.ok) throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å dz.json");
        scheduleData = await res.json();
        // –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–Ω–µ–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–Ω–∏
        if(Object.keys(scheduleData).length === 0){
          daysOfWeek = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞"];
        } else {
          daysOfWeek = Object.keys(scheduleData);
        }
      } catch(e){
        console.error(e);
        // fallback: –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç (—á—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ –ª–æ–º–∞–ª—Å—è)
        scheduleData = {};
      }
      renderDays();
      renderSchedule();
    }

    function renderDays(){
      const daysContainer = document.getElementById("days");
      daysContainer.innerHTML = "";
      daysOfWeek.forEach(day => {
        const div = document.createElement("div");
        div.className = "day" + (day===currentDay ? " active":"");
        div.textContent = day;
        div.onclick = ()=>{ currentDay = day; renderDays(); renderSchedule(); };
        daysContainer.appendChild(div);
      });
    }

    function renderSchedule(){
      const container = document.getElementById("schedule");
      container.innerHTML = "";
      if(!scheduleData[currentDay]) return;
      scheduleData[currentDay].forEach((lesson,i)=>{
        const div = document.createElement("div");
        div.className = "lesson";
        const hw = lesson.homework ? ("<div><strong>–î–ó:</strong> " + lesson.homework + "</div>") : "";
        const dl = lesson.deadline ? ("<div><small>–î–µ–¥–ª–∞–π–Ω: " + lesson.deadline + "</small></div>") : "";
        div.innerHTML = `<h4>${i+1}. ${lesson.name}</h4><small>${lesson.teacher||""}</small>${hw}${dl}`;
        div.onclick = ()=>openModal(i);
        container.appendChild(div);
      });
    }

    function openModal(index){
      const lesson = scheduleData[currentDay][index];
      document.getElementById("modalTitle").textContent = lesson.name;
      document.getElementById("homeworkText").textContent = lesson.homework || "–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";
      document.getElementById("deadlineText").textContent = lesson.deadline ? ("–î–µ–¥–ª–∞–π–Ω: " + lesson.deadline) : "–î–µ–¥–ª–∞–π–Ω: ‚Äî";
      document.getElementById("gradeText").textContent = lesson.grade ? ("–û—Ü–µ–Ω–∫–∞: " + lesson.grade) : "–û—Ü–µ–Ω–∫–∞: ‚Äî";
      document.getElementById("modal").style.display = "flex";
    }

    function closeModal(){ document.getElementById("modal").style.display = "none"; }

    function exportData(){
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(scheduleData));
      const dl = document.createElement("a");
      dl.setAttribute("href", dataStr);
      dl.setAttribute("download", "schedule.json");
      dl.click();
    }

    loadSchedule();
  </script>
</body>
</html>
